const _0x43163b=_0x12b7;(function(_0xadad4f,_0x5c044e){const _0x265038=_0x12b7,_0x35b127=_0xadad4f();while(!![]){try{const _0x33805b=parseInt(_0x265038(0x11d))/0x1+-parseInt(_0x265038(0x128))/0x2+-parseInt(_0x265038(0x131))/0x3*(parseInt(_0x265038(0x13e))/0x4)+-parseInt(_0x265038(0x151))/0x5+-parseInt(_0x265038(0x15e))/0x6*(-parseInt(_0x265038(0x11b))/0x7)+parseInt(_0x265038(0x167))/0x8+parseInt(_0x265038(0x126))/0x9*(parseInt(_0x265038(0x163))/0xa);if(_0x33805b===_0x5c044e)break;else _0x35b127['push'](_0x35b127['shift']());}catch(_0x1c534c){_0x35b127['push'](_0x35b127['shift']());}}}(_0x3bc3,0x6ca72));import{connect}from'cloudflare:sockets';let userID=_0x43163b(0x158),proxyIP='';if(!isValidUUID(userID))throw new Error(_0x43163b(0x127));export default{async 'fetch'(_0x5b2bee,_0x4b6ac0,_0x269a86){const _0x10ade0=_0x43163b;try{userID=_0x4b6ac0[_0x10ade0(0x124)]||userID,proxyIP=_0x4b6ac0[_0x10ade0(0x121)]||proxyIP;const _0x5dc177=_0x5b2bee[_0x10ade0(0x11f)][_0x10ade0(0x12f)](_0x10ade0(0x161));if(!_0x5dc177||_0x5dc177!==_0x10ade0(0x13b)){const _0x3b0157=new URL(_0x5b2bee[_0x10ade0(0x146)]);switch(_0x3b0157[_0x10ade0(0x15c)]){case'/':return new Response(JSON[_0x10ade0(0x15b)](_0x5b2bee['cf']),{'status':0xc8});case'/'+userID:{const _0xac9ee4=getVLESSConfig(userID,_0x5b2bee[_0x10ade0(0x11f)][_0x10ade0(0x12f)](_0x10ade0(0x145)));return new Response(''+_0xac9ee4,{'status':0xc8,'headers':{'Content-Type':_0x10ade0(0x14b)}});}default:return new Response(_0x10ade0(0x14f),{'status':0x194});}}else return await vlessOverWSHandler(_0x5b2bee);}catch(_0x2aba41){let _0x340074=_0x2aba41;return new Response(_0x340074['toString']());}}};async function vlessOverWSHandler(_0x167e0c){const _0x5db50f=_0x43163b,_0xda88e9=new WebSocketPair(),[_0x35eb7d,_0x58068d]=Object['values'](_0xda88e9);_0x58068d[_0x5db50f(0x137)]();let _0x3eb760='',_0x1c6ed6='';const _0x252799=(_0x265882,_0x4783e8)=>{const _0x320341=_0x5db50f;console[_0x320341(0x122)]('['+_0x3eb760+':'+_0x1c6ed6+']\x20'+_0x265882,_0x4783e8||'');},_0x28a485=_0x167e0c[_0x5db50f(0x11f)][_0x5db50f(0x12f)]('sec-websocket-protocol')||'',_0x478708=makeReadableWebSocketStream(_0x58068d,_0x28a485,_0x252799);let _0x32d82f={'value':null},_0x107a0e=null,_0x51a27e=![];return _0x478708[_0x5db50f(0x129)](new WritableStream({async 'write'(_0x3b2f99,_0x2b7a15){const _0xc1e46e=_0x5db50f;if(_0x51a27e&&_0x107a0e)return _0x107a0e(_0x3b2f99);if(_0x32d82f[_0xc1e46e(0x144)]){const _0x36d362=_0x32d82f[_0xc1e46e(0x144)]['writable']['getWriter']();await _0x36d362[_0xc1e46e(0x130)](_0x3b2f99),_0x36d362[_0xc1e46e(0x133)]();return;}const {hasError:_0x2eb1b1,message:_0x4273a9,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:_0x3d49f3,vlessVersion:vlessVersion=new Uint8Array([0x0,0x0]),isUDP:_0x3ebca9}=processVlessHeader(_0x3b2f99,userID);_0x3eb760=addressRemote,_0x1c6ed6=portRemote+'--'+Math[_0xc1e46e(0x15f)]()+'\x20'+(_0x3ebca9?'udp\x20':_0xc1e46e(0x168))+'\x20';if(_0x2eb1b1){throw new Error(_0x4273a9);return;}if(_0x3ebca9){if(portRemote===0x35)_0x51a27e=!![];else{throw new Error(_0xc1e46e(0x160));return;}}const _0x20a33b=new Uint8Array([vlessVersion[0x0],0x0]),_0x5bf65f=_0x3b2f99['slice'](_0x3d49f3);if(_0x51a27e){const {write:_0x3be1b2}=await handleUDPOutBound(_0x58068d,_0x20a33b,_0x252799);_0x107a0e=_0x3be1b2,_0x107a0e(_0x5bf65f);return;}handleTCPOutBound(_0x32d82f,addressRemote,portRemote,_0x5bf65f,_0x58068d,_0x20a33b,_0x252799);},'close'(){_0x252799('readableWebSocketStream\x20is\x20close');},'abort'(_0x1fd2d3){const _0x1474ba=_0x5db50f;_0x252799(_0x1474ba(0x13d),JSON[_0x1474ba(0x15b)](_0x1fd2d3));}}))[_0x5db50f(0x12b)](_0xae9ac8=>{_0x252799('readableWebSocketStream\x20pipeTo\x20error',_0xae9ac8);}),new Response(null,{'status':0x65,'webSocket':_0x35eb7d});}async function handleTCPOutBound(_0x3715f4,_0x10f9c5,_0x5e88ad,_0x318730,_0x1e4876,_0x377fe9,_0x37fde5){async function _0x260bba(_0x349746,_0x17225a){const _0x2ffcf1=_0x12b7,_0x11777b=connect({'hostname':_0x349746,'port':_0x17225a});_0x3715f4[_0x2ffcf1(0x144)]=_0x11777b,_0x37fde5('connected\x20to\x20'+_0x349746+':'+_0x17225a);const _0x52409f=_0x11777b[_0x2ffcf1(0x138)][_0x2ffcf1(0x15a)]();return await _0x52409f[_0x2ffcf1(0x130)](_0x318730),_0x52409f['releaseLock'](),_0x11777b;}async function _0x55592a(){const _0x1a5d45=_0x12b7,_0xad7f2c=await _0x260bba(proxyIP||_0x10f9c5,_0x5e88ad);_0xad7f2c[_0x1a5d45(0x140)][_0x1a5d45(0x12b)](_0x546181=>{const _0x595c8d=_0x1a5d45;console[_0x595c8d(0x122)]('retry\x20tcpSocket\x20closed\x20error',_0x546181);})['finally'](()=>{safeCloseWebSocket(_0x1e4876);}),remoteSocketToWS(_0xad7f2c,_0x1e4876,_0x377fe9,null,_0x37fde5);}const _0xfe241a=await _0x260bba(_0x10f9c5,_0x5e88ad);remoteSocketToWS(_0xfe241a,_0x1e4876,_0x377fe9,_0x55592a,_0x37fde5);}function makeReadableWebSocketStream(_0x2d0046,_0x1debe4,_0x2b47af){let _0x4ccb06=![];const _0x5eb568=new ReadableStream({'start'(_0x5bf54c){const _0x1f127c=_0x12b7;_0x2d0046['addEventListener'](_0x1f127c(0x147),_0x54cc34=>{const _0x4ee755=_0x1f127c;if(_0x4ccb06)return;const _0x234791=_0x54cc34['data'];_0x5bf54c[_0x4ee755(0x152)](_0x234791);}),_0x2d0046[_0x1f127c(0x136)](_0x1f127c(0x125),()=>{const _0x3daf61=_0x1f127c;safeCloseWebSocket(_0x2d0046);if(_0x4ccb06)return;_0x5bf54c[_0x3daf61(0x125)]();}),_0x2d0046[_0x1f127c(0x136)]('error',_0xb87835=>{const _0x10091f=_0x1f127c;_0x2b47af(_0x10091f(0x13f)),_0x5bf54c['error'](_0xb87835);});const {earlyData:_0x4017ff,error:_0xe1484f}=base64ToArrayBuffer(_0x1debe4);if(_0xe1484f)_0x5bf54c[_0x1f127c(0x12a)](_0xe1484f);else _0x4017ff&&_0x5bf54c[_0x1f127c(0x152)](_0x4017ff);},'pull'(_0x569e89){},'cancel'(_0x1490c5){const _0x493758=_0x12b7;if(_0x4ccb06)return;_0x2b47af(_0x493758(0x132)+_0x1490c5),_0x4ccb06=!![],safeCloseWebSocket(_0x2d0046);}});return _0x5eb568;}function processVlessHeader(_0x1a14d4,_0x3e4da2){const _0x3a9bc2=_0x43163b;if(_0x1a14d4[_0x3a9bc2(0x13c)]<0x18)return{'hasError':!![],'message':'invalid\x20data'};const _0x14fc81=new Uint8Array(_0x1a14d4[_0x3a9bc2(0x157)](0x0,0x1));let _0x4436f1=![],_0x5e8e01=![];stringify(new Uint8Array(_0x1a14d4[_0x3a9bc2(0x157)](0x1,0x11)))===_0x3e4da2&&(_0x4436f1=!![]);if(!_0x4436f1)return{'hasError':!![],'message':_0x3a9bc2(0x11a)};const _0x587edd=new Uint8Array(_0x1a14d4[_0x3a9bc2(0x157)](0x11,0x12))[0x0],_0x284498=new Uint8Array(_0x1a14d4['slice'](0x12+_0x587edd,0x12+_0x587edd+0x1))[0x0];if(_0x284498===0x1){}else{if(_0x284498===0x2)_0x5e8e01=!![];else return{'hasError':!![],'message':_0x3a9bc2(0x14a)+_0x284498+_0x3a9bc2(0x153)};}const _0x15061c=0x12+_0x587edd+0x1,_0x436b3b=_0x1a14d4['slice'](_0x15061c,_0x15061c+0x2),_0x51b314=new DataView(_0x436b3b)['getUint16'](0x0);let _0x2c8c3a=_0x15061c+0x2;const _0x37eb1d=new Uint8Array(_0x1a14d4['slice'](_0x2c8c3a,_0x2c8c3a+0x1)),_0x2cd7f5=_0x37eb1d[0x0];let _0x10471f=0x0,_0x320061=_0x2c8c3a+0x1,_0x4e643b='';switch(_0x2cd7f5){case 0x1:_0x10471f=0x4,_0x4e643b=new Uint8Array(_0x1a14d4[_0x3a9bc2(0x157)](_0x320061,_0x320061+_0x10471f))[_0x3a9bc2(0x14c)]('.');break;case 0x2:_0x10471f=new Uint8Array(_0x1a14d4[_0x3a9bc2(0x157)](_0x320061,_0x320061+0x1))[0x0],_0x320061+=0x1,_0x4e643b=new TextDecoder()[_0x3a9bc2(0x150)](_0x1a14d4[_0x3a9bc2(0x157)](_0x320061,_0x320061+_0x10471f));break;case 0x3:_0x10471f=0x10;const _0x1deb11=new DataView(_0x1a14d4[_0x3a9bc2(0x157)](_0x320061,_0x320061+_0x10471f)),_0x5ac811=[];for(let _0x51f19c=0x0;_0x51f19c<0x8;_0x51f19c++){_0x5ac811[_0x3a9bc2(0x164)](_0x1deb11[_0x3a9bc2(0x12d)](_0x51f19c*0x2)[_0x3a9bc2(0x139)](0x10));}_0x4e643b=_0x5ac811[_0x3a9bc2(0x14c)](':');break;default:return{'hasError':!![],'message':_0x3a9bc2(0x156)+_0x2cd7f5};}if(!_0x4e643b)return{'hasError':!![],'message':'addressValue\x20is\x20empty,\x20addressType\x20is\x20'+_0x2cd7f5};return{'hasError':![],'addressRemote':_0x4e643b,'addressType':_0x2cd7f5,'portRemote':_0x51b314,'rawDataIndex':_0x320061+_0x10471f,'vlessVersion':_0x14fc81,'isUDP':_0x5e8e01};}async function remoteSocketToWS(_0x43b936,_0x2c7c7e,_0x537a79,_0x299e9b,_0xe1f474){const _0x4bf651=_0x43163b;let _0x274b9d=0x0,_0xa48366=[],_0x100a8a=_0x537a79,_0x43531f=![];await _0x43b936[_0x4bf651(0x123)][_0x4bf651(0x129)](new WritableStream({'start'(){},async 'write'(_0x4deb52,_0x1369c5){const _0x11b822=_0x4bf651;_0x43531f=!![],_0x2c7c7e[_0x11b822(0x12c)]!==WS_READY_STATE_OPEN&&_0x1369c5[_0x11b822(0x12a)](_0x11b822(0x15d)),_0x100a8a?(_0x2c7c7e[_0x11b822(0x14d)](await new Blob([_0x100a8a,_0x4deb52])[_0x11b822(0x162)]()),_0x100a8a=null):_0x2c7c7e['send'](_0x4deb52);},'close'(){const _0x262544=_0x4bf651;_0xe1f474(_0x262544(0x120)+_0x43531f);},'abort'(_0x102d14){console['error']('remoteConnection!.readable\x20abort',_0x102d14);}}))[_0x4bf651(0x12b)](_0x1fd8ed=>{const _0x3e2167=_0x4bf651;console['error']('remoteSocketToWS\x20has\x20exception\x20',_0x1fd8ed[_0x3e2167(0x134)]||_0x1fd8ed),safeCloseWebSocket(_0x2c7c7e);}),_0x43531f===![]&&_0x299e9b&&(_0xe1f474(_0x4bf651(0x165)),_0x299e9b());}function base64ToArrayBuffer(_0x57d8e9){const _0x5a20e1=_0x43163b;if(!_0x57d8e9)return{'error':null};try{_0x57d8e9=_0x57d8e9[_0x5a20e1(0x143)](/-/g,'+')[_0x5a20e1(0x143)](/_/g,'/');const _0x456d0e=atob(_0x57d8e9),_0x3bfe73=Uint8Array[_0x5a20e1(0x135)](_0x456d0e,_0x3f2118=>_0x3f2118[_0x5a20e1(0x155)](0x0));return{'earlyData':_0x3bfe73['buffer'],'error':null};}catch(_0x5ea309){return{'error':_0x5ea309};}}function isValidUUID(_0x1f2799){const _0x2872f7=_0x43163b,_0x4af6da=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return _0x4af6da[_0x2872f7(0x11c)](_0x1f2799);}function _0x3bc3(){const _0x478c1f=['769332sVSLJc','pipeTo','error','catch','readyState','getUint16','&fp=randomized&type=ws&host=','get','write','1446EwvWil','ReadableStream\x20was\x20canceled,\x20due\x20to\x20','releaseLock','stack','from','addEventListener','accept','writable','toString','safeCloseWebSocket\x20error','websocket','byteLength','readableWebSocketStream\x20is\x20abort','256XiWYXQ','webSocketServer\x20has\x20error','closed','vless','\x0a\x20\x20client-fingerprint:\x20chrome\x0a\x20\x20ws-opts:\x0a\x20\x20\x20\x20path:\x20\x22/?ed=2048\x22\x0a\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20host:\x20','replace','value','Host','url','message','\x0a\x20\x20network:\x20ws\x0a\x20\x20tls:\x20true\x0a\x20\x20udp:\x20false\x0a\x20\x20sni:\x20','\x0a################################################################\x0av2ray\x0a---------------------------------------------------------------\x0a','command\x20','text/plain;charset=utf-8','join','send','Stringified\x20UUID\x20is\x20invalid','Not\x20found','decode','3034305GESnGj','enqueue','\x20is\x20not\x20support,\x20command\x2001-tcp,02-udp,03-mux','://','charCodeAt','invild\x20\x20addressType\x20is\x20','slice','d342d11e-d424-4583-b36e-524ab1f0afa4','&path=%2F%3Fed%3D2048#','getWriter','stringify','pathname','webSocket.readyState\x20is\x20not\x20open,\x20maybe\x20close','48foJRGU','random','UDP\x20proxy\x20only\x20enable\x20for\x20DNS\x20which\x20is\x20port\x2053','Upgrade','arrayBuffer','10ukwFyj','push','retry','\x0a---------------------------------------------------------------\x0a################################################################\x0a','746856waMBag','tcp\x20','application/dns-message','dns\x20udp\x20has\x20error','?encryption=none&security=tls&sni=','invalid\x20user','140686cIwurK','test','820613BThENb','\x0a\x20\x20server:\x20','headers','remoteConnection!.readable\x20is\x20close\x20with\x20hasIncomingData\x20is\x20','PROXYIP','log','readable','UUID','close','3533967kcpLkc','uuid\x20is\x20not\x20valid'];_0x3bc3=function(){return _0x478c1f;};return _0x3bc3();}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x2ca090){const _0x199026=_0x43163b;try{(_0x2ca090[_0x199026(0x12c)]===WS_READY_STATE_OPEN||_0x2ca090['readyState']===WS_READY_STATE_CLOSING)&&_0x2ca090['close']();}catch(_0x4ad1e5){console[_0x199026(0x12a)](_0x199026(0x13a),_0x4ad1e5);}}function _0x12b7(_0x11f16a,_0x463359){const _0x3bc386=_0x3bc3();return _0x12b7=function(_0x12b7a8,_0x9f7f34){_0x12b7a8=_0x12b7a8-0x117;let _0x1a8158=_0x3bc386[_0x12b7a8];return _0x1a8158;},_0x12b7(_0x11f16a,_0x463359);}const byteToHex=[];for(let i=0x0;i<0x100;++i){byteToHex[_0x43163b(0x164)]((i+0x100)[_0x43163b(0x139)](0x10)[_0x43163b(0x157)](0x1));}function unsafeStringify(_0x3033d5,_0x48ceb8=0x0){return(byteToHex[_0x3033d5[_0x48ceb8+0x0]]+byteToHex[_0x3033d5[_0x48ceb8+0x1]]+byteToHex[_0x3033d5[_0x48ceb8+0x2]]+byteToHex[_0x3033d5[_0x48ceb8+0x3]]+'-'+byteToHex[_0x3033d5[_0x48ceb8+0x4]]+byteToHex[_0x3033d5[_0x48ceb8+0x5]]+'-'+byteToHex[_0x3033d5[_0x48ceb8+0x6]]+byteToHex[_0x3033d5[_0x48ceb8+0x7]]+'-'+byteToHex[_0x3033d5[_0x48ceb8+0x8]]+byteToHex[_0x3033d5[_0x48ceb8+0x9]]+'-'+byteToHex[_0x3033d5[_0x48ceb8+0xa]]+byteToHex[_0x3033d5[_0x48ceb8+0xb]]+byteToHex[_0x3033d5[_0x48ceb8+0xc]]+byteToHex[_0x3033d5[_0x48ceb8+0xd]]+byteToHex[_0x3033d5[_0x48ceb8+0xe]]+byteToHex[_0x3033d5[_0x48ceb8+0xf]])['toLowerCase']();}function stringify(_0x3e0d43,_0x1a971f=0x0){const _0x45a814=_0x43163b,_0x8f14af=unsafeStringify(_0x3e0d43,_0x1a971f);if(!isValidUUID(_0x8f14af))throw TypeError(_0x45a814(0x14e));return _0x8f14af;}async function handleUDPOutBound(_0x35b707,_0x2196b2,_0x5c67a2){const _0x4648db=_0x43163b;let _0x4e1808=![];const _0x5e8e20=new TransformStream({'start'(_0x5111b2){},'transform'(_0x2f44c6,_0x5f14fa){const _0x248d49=_0x12b7;for(let _0x509c4d=0x0;_0x509c4d<_0x2f44c6[_0x248d49(0x13c)];){const _0x473590=_0x2f44c6['slice'](_0x509c4d,_0x509c4d+0x2),_0x349977=new DataView(_0x473590)['getUint16'](0x0),_0x47e412=new Uint8Array(_0x2f44c6['slice'](_0x509c4d+0x2,_0x509c4d+0x2+_0x349977));_0x509c4d=_0x509c4d+0x2+_0x349977,_0x5f14fa[_0x248d49(0x152)](_0x47e412);}},'flush'(_0x5ac23b){}});_0x5e8e20[_0x4648db(0x123)][_0x4648db(0x129)](new WritableStream({async 'write'(_0x291705){const _0x1dda40=_0x4648db,_0x4faaea=await fetch('https://1.1.1.1/dns-query',{'method':'POST','headers':{'content-type':_0x1dda40(0x117)},'body':_0x291705}),_0x272501=await _0x4faaea[_0x1dda40(0x162)](),_0x4e9c55=_0x272501['byteLength'],_0x4cef16=new Uint8Array([_0x4e9c55>>0x8&0xff,_0x4e9c55&0xff]);_0x35b707[_0x1dda40(0x12c)]===WS_READY_STATE_OPEN&&(_0x5c67a2('doh\x20success\x20and\x20dns\x20message\x20length\x20is\x20'+_0x4e9c55),_0x4e1808?_0x35b707[_0x1dda40(0x14d)](await new Blob([_0x4cef16,_0x272501])['arrayBuffer']()):(_0x35b707[_0x1dda40(0x14d)](await new Blob([_0x2196b2,_0x4cef16,_0x272501])[_0x1dda40(0x162)]()),_0x4e1808=!![]));}}))['catch'](_0x2d9c32=>{const _0x34233e=_0x4648db;_0x5c67a2(_0x34233e(0x118)+_0x2d9c32);});const _0x4a5d6c=_0x5e8e20[_0x4648db(0x138)][_0x4648db(0x15a)]();return{'write'(_0x231e11){_0x4a5d6c['write'](_0x231e11);}};}function getVLESSConfig(_0x5e5095,_0x1cd9ed){const _0x173cdb=_0x43163b,_0x581ee8=_0x173cdb(0x141),_0x5733fc=''+_0x581ee8+(_0x173cdb(0x154)+_0x5e5095+'@'+_0x1cd9ed+':443')+(_0x173cdb(0x119)+_0x1cd9ed+_0x173cdb(0x12e)+_0x1cd9ed+_0x173cdb(0x159)+_0x1cd9ed);return _0x173cdb(0x149)+_0x5733fc+'\x0a---------------------------------------------------------------\x0a################################################################\x0aclash-meta\x0a---------------------------------------------------------------\x0a-\x20type:\x20vless\x0a\x20\x20name:\x20'+_0x1cd9ed+_0x173cdb(0x11e)+_0x1cd9ed+'\x0a\x20\x20port:\x20443\x0a\x20\x20uuid:\x20'+_0x5e5095+_0x173cdb(0x148)+_0x1cd9ed+_0x173cdb(0x142)+_0x1cd9ed+_0x173cdb(0x166);}
